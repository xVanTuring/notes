# 网络协议和体系结构
## 概述
* 协议：通信双方必须要遵守的规则和约定称为协议或者规程
* 协议的要素：语法、语义和时序关系
* 分层的核心思路时上一层的功能建立在下一层的功能基础上，并且在每一层内均遵守一定的通信规则
* 分层思想的好处：
    * 各层次之间可以相互独立
    * 有较强的灵活性、便于实现和维护
    * 分层的思想有利于标准化
* **层次和协议**的集合构成了网络的体系结构
* OSI 参考模型和 TCP/IP 参考模型时目前常用的两种典型参考模型
## OSI
* OSI 包括：物理层、数据链路层、网络层、传输层（运输层）、会话层、表示层和应用层
* 物理层、数据链路层、网络层 被称为节点到节点层，传输层、会话层、表示层和应用层称为端到端层
* 物理层：主要功能是在传输介质上实现无结构比特流传输
* 数据链路层：实现相邻节点之间的数据可靠而有效地传输，以帧为单位
* 网络层：数据转发与路由
* 传输层：复用/解复用、端到端的可靠数据传输、连接控制、流量控制和拥塞控制机制
* 会话层、表示层
* 应用层： 与提供给用户的网络服务相关，这些服务非常丰富，包括文件传输、电子邮件和P2P应用
### OSI 术语
* 数据单元：在层的实体之间传送的比特组被称为数据单元
* 服务访问点 SAP：相邻层间的服务是通过其接口面上的服务访问点进行的
* 服务原语：
    * 请求
    * 指示
    * 响应
    * 确认
*  分层体系结构中：下层向上层提供服务的类型包括：面向连接的服务和无连接的服务
* 面向连接的服务以电话系统最为典型，面向连接的服务也被称为虚电路服务
## TCP/IP参考模型
* 1974年第一版发表
* 包含层有：网络接口层、网络互联层、传输层和应用层
* 网络互联层是核心，解决把数据分组发往目的网络或主机的问题
* OSI 和 TCP/IP 的区别（P74）
    * 层次划分不同
    * 面向连接和面向无连接的通信不同
    * 具体协议配合程度
## TCP 和 UDP
* TCP/IP参考模型包含 IP，TCP，UDP，DNS，HTTP和FTP
* 定义了两个传输层协议：面向连接的传输控制协议TCP和无连接的用户数据报协议UDP
* 端口号为一个16位二进制整数
* TCP 连接管理包括连接建立、数据传输、连接拆除
### UDP
* 首部：16位源端口，16位目的端口，16位长度，16位校验和
* 理论最大长度65535B，通常为8192B
### TCP
* 首部：
    * 固定20字节，16位源端口，16位目的端口，32位序列号，32位确认序号，4位首部长度（4B单位），6位保留字段，UAPRSF6位（状态位），16位窗口字段，16位校验和，16位紧急指针
    * 选项字段（变长）
    * 填充字段，填充到头部位4B倍数
* 流量控制：通过通告接收缓存空间作为接受窗口，来通知对方
* 拥塞控制（P80）