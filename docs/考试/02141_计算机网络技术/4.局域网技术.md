# 4.局域网技术

## 概述
* 局域网技术研究开始于 20世纪70年代初
    * 1975 年 施乐公司研发了基于总线的局域网产品-以太网
    * 1980 年 DEC、Inter 公司研发了 DIX V1
    * 1982 年 DIX V2
* IEEE 802 委员会专门负责局域网标准化工作于1980年成立
* IEEE 802 早期标准 局域网只对应 OSI 参考模型的 ^^数据链路层^^ 和 ^^物理层^^ 两个层次
* 标准将数据链路层分为：^^逻辑链路控制子层LLC-Logical Link Control^^ 和 ^^介质访问控制子层MAC-Madia Access Control^^
    * `MAC` 负责封装上层数据进行发送、寻址和比特差错检测
    * `LLC` 负责与介质接入无关的内容，如建立和释放数据链路层的逻辑，提供帧序号，提供高层接口和差错控制等。
    * `MAC` 子层可以采用不同的技术和协议，但是 `LCC` 必须使用相同的技术和协议
## 以太网技术
* 技术规范包括：拓扑结构、传输介质、介质访问方式、传输速率、最多工作站数和最远传输距离
* 早起以太网 10Base-5: 采用*总线型拓扑*、粗同轴电缆，速率为10Mbit/s，最多工作站1024，最远距离2500M
* 以太网采用 ^^载波监听多路访问/冲突检测^^（CSMA/CD）作为介质
* MAC 地址：用*48bit*二进制数据作为局域网的全球地址，表示每一块局域网适配器，前3个字节(24bit)是厂商区块
* 在以太网的MAC层，数据以 ^^帧^^ 的形式存在
### CSMA/CD
!!! CSMA
    * Carrier Sense Multiple Access
    * 载波监听多路访问

先监听，再发送；边发送，边监听
### DIX Ethernet V2 和 IEEE 802.3
这两个协议基本相同，区别在于帧格式中的2字节 类型字段的意义

* V2 标准只用于类型
* 802.3：当值小于0x0600 时，用来标识 MAC 帧数据部分的字节数，即用来保存长度，反之则时类型
* 6字节目的地址、6字节源地址、2字节类型/长度、数据(__46-1500字节__)、4字节帧检测序列FSC
* 总长 64字节 到 1518字节
### 几个以太网标准（P89）
* *粗缆*以太网 10Base-5
    * 10 表示速率为 10Mbit/s
    * Base 表示基带传输
    * 5 表示每一段电缆最大长度为500M，超出后需要用中继器放大信号，最多4个中继器（最长2500m），一条干线最多100个工作站
* *细缆*以太网 10Base-2：0.2英寸的50欧姆同轴电缆，单线缆最长200M，最多四个中继器（最长910），一条干线最多30个工作站
* *双绞线*以太网 10Base-T：使用UTP非屏蔽双绞线，单线缆最长100M，最多4个集线器
* 快速以太网100Base-T：帧格式不变，保留 CSMA/CD
* 千兆位以太网：帧格式不变，保留 CSMA/CD
* 万兆位以太网 802.3ae：帧格式不变，不使用 CSMA/CD，只支持全双工

### 拓展
* 物理层拓展：中继器和集线器
    * 中继器：用来连接两个以太网网段，对衰减信号进行整形放大
    * 集线器：是多端口的特殊的中继器，共享带宽
* 数据链路层拓展：网桥和交换机
    * 网桥接口较少通常只有2到4个，收到消息后会根据MAC地址来转发和过滤帧消息
    * 以太网交换机也被称为第二层交换机，实质是多接口的网桥
        * 分类： ^^单台交换机^^ 、^^堆叠交换机^^ 和 ^^箱体模块化交换机^^
### 交换式以太网的优点
* 可以在保留现有的以太网基础设施的基础上进行拓展，无需丢弃和重建现有网络
* 允许多对主机同时通信、每一对通信的主机都可以独占传输媒体，实现无碰撞的数据传输
* 可以连接不同速率的以太网，满足不同网络环境进行互联扩充的要求
* 可以基于以太网交换机实现帧过滤、传输控制、和虚拟局域网设置等多种功能
## 虚拟局域网
* 虚拟局域网: 是由一些局域网网段构成的与物理位置无关的逻辑组，而这些网段具有某些共同的需求。每个VLAN都有个标识符，用来指明发送这个帧的主机属于哪个VLAN
* 虚拟局域网的设置是在以太网交换机上，通过软件方式实现的
* 定义在 802.1Q 中
### 基本原理
* 在虚拟局域网中的每一个主机都可以收到同一个虚拟局域网内的其他主机所发出的广播；当一个主机向虚拟局域网内的其他主机发送数据时，虚拟局域网外的其他主机不会收到其所发的广播信息。
* 这样的工作机制可以限制接受广播信息的主机数，避免局域网因过多的广播信息而引起性能恶化，即“抑制广播风暴”
### 虚拟局域网划分方式
* 基于交换机端口的划分
* 基于MAC地址的划分
* 基于上层协议类型或地址的划分
### 帧格式
* 目的地址、源地址、4字节VLAN标记、2字节类型、数据，FCS
* VLAN标记32位：802.1Q 16位标志（0x8100），3位用户优先级、1位规范格式标识符CFI，12位标识符VID
### VLAN Trunk 无线局域网中继技术 P97
两个交换机之间用一条链路级联，并把对应的端口设置为 Trunk 端口，这样可以使得两个交换机上的处于同一个VLAN的主机进行通信
### 虚拟局域网操作(思科交换机)
| 操作                 | 指令                                                                         |                                      |
| -------------------- | :--------------------------------------------------------------------------- | :----------------------------------- |
| 初始化               | `enable`                                                                     | 特权                                 |
|                      | `configure terminal`                                                         | 全局配置模式                         |
| 创建                 | `switch(config)#vlan 100`                                                    | 创建                                 |
| 删除                 | `switch(config)#no vlan 100 `                                                | 删除                                 |
| 指定端口到 vlan      | `switch(config)#interface port-id`                                           | 进入这个端口进行配置                 |
|                      | `switch(config-if)#switchport access vlan 100`                               | 将该端口作为 access 端口加入Vlan 100 |
| 配置 Trunk           | `switch(config)#interface port-id`                                           | 进入这个端口进行配置                 |
|                      | `switchport mode trunk`                                                      | 端口配置为 `trunk` 模式              |
|                      | `switchport trunk allowed vlan {all \| [add \| remove \| except]} vlan-list` | 配置权限                             |
| 将端口从 vlan 中移除 | `interface port-id`                                                          | 进入这个端口进行配置                 |
|                      | `no switchport access vlan`                                                  | 移除                                 |
| 移除 Trunk配置       | `interface port-id`                                                          |                                      |
|                      | `switchport trunk allowed vlan remove vlan-id`                               | 把 `trunk` 端口从 vlan-id 中移除     |
| 显示 vlan 信息       | `show lan`                                                                   |                                      |
|                      | `show lan id xxxx`                                                           |                                      |

## 无线局域网
* 无线局域网可以分为：有固定设施的无线局域网 和 无固定基础设施的局域网
    * 有固定设施的无线局域网：网络中已经预先存在了一批固定的数据处理和转发设备，这些固定设备可以通过有线网络方式连接其他网络或Internet
    * 无固定基础设施的局域网：网络中的每个成员都是对等的可移动设备，也被称为自组网络 Ad Hoc
* IEEE 802.11 是无线以太网的标准，采用 ==星型拓扑结构==，移动站通过无线方式与AP连接，再由AP通过有线介质连接其他网络，也被称为Wi-Fi网络
* 无线局域网使用 `CSMA/CA`协议
    * 采用停止-等待的可靠传输方式
    * 采用虚拟载波监听机制
* ^^BSS 基本服务集^^：WLAN的最小单位，包含一个AP和多个移动设备

